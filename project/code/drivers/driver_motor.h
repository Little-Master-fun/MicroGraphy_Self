/*********************************************************************************************************************
* 文件名称          driver_motor.h
* 功能说明          双电机驱动程序头文件
* 作者              LittleMaster
* 版本信息          v1.0
* 修改记录
* 日期              作者                版本
* 2025-09-17        LittleMaster       1.0v
* 
* 文件作用说明：
* 本文件为双电机驱动系统的头文件，支持左右两个独立电机的控制
* 
* 主要功能：
* 1. 电机初始化和配置
* 2. 电机方向控制
* 3. 电机速度控制
* 4. 电机保护功能
********************************************************************************************************************/

#ifndef _DRIVER_MOTOR_H_
#define _DRIVER_MOTOR_H_

#include "zf_common_typedef.h"

//=================================================硬件引脚定义================================================
// 左电机控制引脚定义
#define MOTOR_LEFT_IN1          (P03_0)     // 左电机方向控制引脚1
#define MOTOR_LEFT_IN2          (P05_1)     // 左电机方向控制引脚2
#define MOTOR_LEFT_PWM1         (TCPWM_CH00_P03_1)  // 左电机PWM通道1
#define MOTOR_LEFT_PWM2         (TCPWM_CH01_P03_0)  // 左电机PWM通道2

// 右电机控制引脚定义  
#define MOTOR_RIGHT_IN1         (P02_4)     // 右电机方向控制引脚1
#define MOTOR_RIGHT_IN2         (P06_3)     // 右电机方向控制引脚2
#define MOTOR_RIGHT_PWM1        (TCPWM_CH04_P02_3)  // 右电机PWM通道1
#define MOTOR_RIGHT_PWM2        (TCPWM_CH03_P02_4)  // 右电机PWM通道2

// 开关输入引脚（可选）
#define SWITCH1                 (P21_5)
#define SWITCH2                 (P21_6)

//=================================================配置参数定义================================================
#define MOTOR_PWM_FREQUENCY     (17000)     // PWM频率 17KHz
#define MOTOR_PWM_MAX           (9999)      // PWM最大占空比
#define MOTOR_PWM_MIN           (10)        // PWM最小有效占空比
#define MOTOR_PWM_INIT_DUTY     (0)         // PWM初始占空比

//=================================================枚举类型定义================================================
// 电机ID枚举
typedef enum
{
    MOTOR_LEFT  = 0,                        // 左电机
    MOTOR_RIGHT = 1,                        // 右电机
    MOTOR_BOTH  = 2,                        // 双电机
} motor_id_enum;

// 电机方向枚举
typedef enum
{
    MOTOR_STOP      = 0,                    // 停止
    MOTOR_FORWARD   = 1,                    // 正转
    MOTOR_BACKWARD  = 2,                    // 反转
} motor_direction_enum;

// 电机状态枚举
typedef enum
{
    MOTOR_STATUS_OK     = 0,                // 正常
    MOTOR_STATUS_ERROR  = 1,                // 错误
} motor_status_enum;

//=================================================函数声明================================================
//-------------------------------------------------------------------------------------------------------------------
// 函数简介     电机系统初始化
// 参数说明     void
// 返回参数     motor_status_enum   初始化状态
// 使用示例     motor_init();
// 备注信息     初始化PWM通道和GPIO引脚
//-------------------------------------------------------------------------------------------------------------------
motor_status_enum motor_init(void);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     设置电机方向
// 参数说明     motor_id            电机ID (MOTOR_LEFT/MOTOR_RIGHT/MOTOR_BOTH)
// 参数说明     direction           电机方向 (MOTOR_STOP/MOTOR_FORWARD/MOTOR_BACKWARD)
// 返回参数     motor_status_enum   执行状态
// 使用示例     motor_set_direction(MOTOR_LEFT, MOTOR_FORWARD);
// 备注信息     设置电机转动方向
//-------------------------------------------------------------------------------------------------------------------
motor_status_enum motor_set_direction(motor_id_enum motor_id, motor_direction_enum direction);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     设置电机速度
// 参数说明     motor_id            电机ID (MOTOR_LEFT/MOTOR_RIGHT/MOTOR_BOTH)
// 参数说明     speed               电机速度 (-MOTOR_PWM_MAX ~ MOTOR_PWM_MAX)
// 返回参数     motor_status_enum   执行状态
// 使用示例     motor_set_speed(MOTOR_LEFT, 5000);
// 备注信息     正值正转，负值反转，自动处理方向控制
//-------------------------------------------------------------------------------------------------------------------
motor_status_enum motor_set_speed(motor_id_enum motor_id, int16 speed);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     停止电机
// 参数说明     motor_id            电机ID (MOTOR_LEFT/MOTOR_RIGHT/MOTOR_BOTH)
// 返回参数     motor_status_enum   执行状态
// 使用示例     motor_stop(MOTOR_BOTH);
// 备注信息     停止指定电机
//-------------------------------------------------------------------------------------------------------------------
motor_status_enum motor_stop(motor_id_enum motor_id);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     PWM值保护函数
// 参数说明     pwm_input           输入PWM值
// 返回参数     int16               保护后的PWM值
// 使用示例     protected_pwm = motor_pwm_protect(input_pwm);
// 备注信息     限制PWM值在有效范围内，防止电机损坏
//-------------------------------------------------------------------------------------------------------------------
int16 motor_pwm_protect(int16 pwm_input);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     电机测试函数
// 参数说明     void
// 返回参数     void
// 使用示例     motor_test();
// 备注信息     用于测试电机基本功能
//-------------------------------------------------------------------------------------------------------------------
void motor_test(void);

//-------------------------------------------------------------------------------------------------------------------
// 函数简介     差速运动控制
// 参数说明     linear_speed        线速度 (-MOTOR_PWM_MAX ~ MOTOR_PWM_MAX)
// 参数说明     angular_speed       角速度 (-MOTOR_PWM_MAX ~ MOTOR_PWM_MAX)
// 返回参数     motor_status_enum   执行状态
// 使用示例     motor_differential_drive(3000, 1000);
// 备注信息     基于线速度和角速度控制差速运动
//-------------------------------------------------------------------------------------------------------------------
motor_status_enum motor_differential_drive(int16 linear_speed, int16 angular_speed);

#endif