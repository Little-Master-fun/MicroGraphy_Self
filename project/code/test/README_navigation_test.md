# 导航系统测试模块使用说明

## ? 概述

本导航测试模块(`test_nav.c/test_nav.h`)提供了完整的导航系统测试功能，包括：

- 1×1m 正方形路径自动生成
- 按键控制导航启动/停止
- 实时状态和数据显示
- Pure Pursuit 算法验证
- 导航性能统计

## ? 按键功能

| 按键      | 功能      | 说明                           |
| --------- | --------- | ------------------------------ |
| **KEY_1** | 生成路径  | 创建并保存 1×1m 正方形测试路径 |
| **KEY_2** | 开始/暂停 | 启动导航或暂停/恢复导航        |
| **KEY_3** | 停止返回  | 停止导航并返回空闲状态         |
| **KEY_4** | 紧急停车  | 立即停止所有运动，进入安全模式 |

## ? 屏幕显示

测试运行时屏幕将显示以下信息：

```
Nav Test Status
Status: NAVIGATING
Nav: NAVIGATING
Pos: 0.25,0.43
Error: 0.052m
Loops: 2
Speed: 1.50m/s
KEY2:Pause KEY4:Stop
```

## ? 使用方法

### 方法 1：在主函数中直接调用

```c
#include "test_nav.h"

int main(void)
{
    // 基础初始化
    clock_init(SYSTEM_CLOCK_600M);
    debug_init();
    ips114_init();

    // 启动导航测试
    test_nav_complete();

    return 0;
}
```

### 方法 2：使用提供的示例函数

```c
#include "test_nav_example.h"

int main(void)
{
    test_nav_main_example();  // 完整测试示例
    return 0;
}
```

## ? 测试流程

1. **系统启动**

   - 显示欢迎界面和按键说明
   - 初始化导航系统和传感器

2. **路径生成** (按 KEY_1)

   - 生成 1×1m 正方形路径
   - 5 个路径点：(0,0) → (1,0) → (1,1) → (0,1) → (0,0)
   - 验证路径数据正确性

3. **导航开始** (按 KEY_2)

   - 启动 Pure Pursuit 导航算法
   - 开始实时状态监控和显示

4. **循环导航**

   - 完成一圈后自动重新开始
   - 统计循环次数和性能数据

5. **手动控制**
   - KEY_2：暂停/恢复导航
   - KEY_3：停止并返回
   - KEY_4：紧急停车

## ?? 配置参数

可在`test_nav.h`中调整的关键参数：

```c
#define TEST_SQUARE_SIZE            1.0f        // 正方形边长 m
#define TEST_SQUARE_SPEED           1.5f        // 测试速度 m/s
#define TEST_WAYPOINT_TOLERANCE     0.15f       // 路径点容差 m
#define TEST_CORNER_SPEED           1.0f        // 转角处速度 m/s
```

## ? 性能统计

测试系统会自动统计以下性能数据：

- **循环完成次数**：完成的正方形循环数
- **最大横向误差**：路径跟随的最大偏差
- **平均横向误差**：路径跟随的平均偏差
- **总行驶距离**：累计行驶距离
- **总导航时间**：累计导航时间

## ?? 安全特性

- **紧急停车**：KEY_4 立即停止所有运动
- **状态监控**：实时监控导航系统状态
- **错误处理**：传感器故障自动检测和处理
- **路径偏离检测**：超出安全范围自动停车

## ? 故障排除

### 常见问题及解决方法

1. **路径生成失败**

   - 检查导航系统是否正确初始化
   - 确认编码器和 IMU 传感器连接正常

2. **导航无法启动**

   - 确认路径已成功生成
   - 检查传感器状态是否正常

3. **显示屏无内容**

   - 检查 IPS114 显示屏连接
   - 确认显示屏初始化是否成功

4. **按键无响应**
   - 检查按键硬件连接（P20_0~P20_3）
   - 确认按键初始化是否正确

## ? 文件结构

```
project/code/test/
├── test_nav.h              # 测试头文件
├── test_nav.c              # 测试实现文件
├── test_nav_example.c      # 使用示例
└── README_navigation_test.md # 本说明文档
```

## ? 依赖模块

本测试模块依赖以下系统模块：

- `nav_control.c/h`：导航控制系统
- `zf_device_key.h`：按键驱动
- `zf_device_ips114.h`：显示屏驱动
- `zf_driver_timer.h`：定时器驱动

## ? 技术支持

如遇到问题，请检查：

1. 硬件连接是否正确
2. 传感器是否正常工作
3. 系统初始化是否完成
4. 路径数据是否有效

---

**版本信息：** v1.0  
**创建日期：** 2025-09-19  
**作者：** LittleMaster
