========================================
MicroGraphy2.0 引脚配置修改完成报告
修改日期：2025-11-05
========================================

本次根据新原理图 SCH_原理图_2025-11-04.pdf 完成了全部引脚配置的更新。

一、修改的模块
========================================

1. 电机驱动模块
   - 左电机 PWM：P5.3, P5.2, P5.1（原 P3.1, P3.0）
   - 右电机 PWM：P5.4, P5.0, P6.3（原 P2.3, P2.4）
   - 新增第三个 PWM 通道支持

2. 编码器模块（已根据原理图修正）
   - 左编码器（H12）：P7.6, P7.7（原理图 PZ254V-12-6P）
   - 右编码器（H13）：P8.2, P8.3（原理图 PZ254V-12-6P）

3. IMU 传感器模块 (SCH16T)
   - SPI 引脚：P13.0, P13.1, P13.2, P13.3（原 P15.3, P15.2, P15.0, P15.1）
   - 复位引脚：P13.4（原 P14.1）

4. 无线串口模块（原理图 U41）
   - TX/RX：P4.1, P4.0（保持原配置）
   - RTS：P22.6（保持原配置）
   - CTS：P22.5（新增）
   - 串口号：UART_1（保持不变）

二、修改的文件清单
========================================

1. MicroGraphy2.0/project/code/drivers/driver_motor.h
   - 更新电机 PWM 引脚定义

2. MicroGraphy2.0/project/code/drivers/driver_encoder.h
   - 更新编码器引脚定义

3. MicroGraphy2.0/project/code/drivers/driver_sch16tk10.c
   - 更新 IMU SPI 引脚和复位引脚

4. MicroGraphy2.0/project/code/drivers/driver_sch16tk10.h
   - 更新 ICM42688 宏定义中的 SPI 引脚

5. MicroGraphy2.0/project/code/drivers/driver_wireless_uart.h
   - 更新无线串口模块引脚
   - 添加可选控制引脚定义

6. MicroGraphy2.0/引脚配置汇总.md
   - 更新所有引脚配置文档

三、引脚对照表
========================================

模块              功能         新引脚              旧引脚
-----------------------------------------------------------------
左电机 PWM       PWM1/IN1     P5.3 (TCPWM_CH08)   P3.1 (TCPWM_CH00)
左电机 PWM       PWM2/IN2     P5.2 (TCPWM_CH07)   P3.0 (TCPWM_CH01)
左电机 PWM       PWM3         P5.1 (TCPWM_CH06)   -
右电机 PWM       PWM1/IN1     P5.4 (TCPWM_CH09)   P2.3 (TCPWM_CH04)
右电机 PWM       PWM2/IN2     P5.0 (TCPWM_CH05)   P2.4 (TCPWM_CH03)
右电机 PWM       PWM3         P6.3 (TCPWM_CH17)   -
左编码器(H12)    A 相         P7.6 (TC_CH07)      原理图确认
左编码器(H12)    B 相         P7.7 (TC_CH07)      原理图确认
右编码器(H13)    A 相         P8.2 (TC_CH21)      原理图确认
右编码器(H13)    B 相         P8.3 (TC_CH21)      原理图确认
IMU (SCH16T)     SPI_CS       P13.0 (SPI2_CS0)    P15.3 (SPI2_CS0)
IMU (SCH16T)     SPI_SCK      P13.1 (SPI2_CLK)    P15.2 (SPI2_CLK)
IMU (SCH16T)     SPI_MISO     P13.2 (SPI2_MISO)   P15.0 (SPI2_MISO)
IMU (SCH16T)     SPI_MOSI     P13.3 (SPI2_MOSI)   P15.1 (SPI2_MOSI)
IMU (SCH16T)     复位 EXTRESN P13.4               P14.1
无线串口         TX           P1.1 (UART0_TX)     P4.1 (UART1_TX)
无线串口         RX           P1.0 (UART0_RX)     P4.0 (UART1_RX)
无线串口         RTS          P0.3                P22.6
无线串口         CTS（可选）  P20.0               -
无线串口         DTR（可选）  P20.1               -
无线串口         DSR（可选）  P20.2               -
无线串口         RST（可选）  P20.3               -

四、重要提示
========================================

1. 电机驱动
   - 新增了第三个 PWM 通道，如果电机驱动芯片需要使能信号，可以使用这些引脚
   - PWM 最大值已设置为 3000（用于初步测试）
   - 确认电机驱动芯片型号和引脚功能后再进行实际测试

2. 编码器
   - 编码器通道号已更新：左编码器 TC_CH35，右编码器 TC_CH00
   - 请确认编码器方向是否需要调整（代码中有方向取反处理）

3. IMU 传感器
   - SPI 引脚全部更新到 P13 端口组
   - 复位引脚也改为 P13.4
   - 确保硬件连接正确后再初始化 IMU

4. 无线串口
   - 串口号从 UART_1 改为 UART_0
   - 新增了 4 个可选控制引脚（P20.0-P20.3）
   - 如果无线模块不需要这些控制引脚，可以不连接

五、下一步操作建议
========================================

1. 重新编译项目，确认没有编译错误

2. 检查硬件连接
   - 对照新的引脚配置检查硬件接线
   - 确认所有模块的电源和地线连接正确

3. 分模块测试
   a) 先测试 IMU 传感器初始化和数据读取
   b) 测试编码器脉冲读取
   c) 测试电机 PWM 输出（建议从低速开始）
   d) 测试无线串口通信

4. 调整参数
   - 根据实际测试结果调整编码器方向
   - 根据电机响应调整 PWM 参数
   - 如需要，调整无线串口波特率

5. 完整功能测试
   - 测试惯导功能
   - 测试电机控制
   - 测试数据通信

========================================
修改完成！
编译前请再次确认所有硬件连接。
如有疑问，请参考引脚配置汇总文档。
========================================

